<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>點餐系統 | Carter Dining</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #e74c3c;
            --secondary: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding-bottom: 100px;
            margin: 0;
        }

        .navbar {
            background: var(--dark);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1030;
        }

        .back-home {
            position: fixed;
            top: 70px !important;
            left: 16px;
            z-index: 1031 !important;
            background: rgba(255,255,255,0.95);
            padding: 10px 14px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            text-decoration: none;
            color: #333;
            font-size: 15px;
            font-weight: 500;
            backdrop-filter: blur(8px);
            transition: all 0.2s;
        }
        .back-home:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .hero {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIzMDBweCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIzMDBweCIgZmlsbD0iI2U3NGMzYyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjRweCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5Qcm9mZXNzaW9uYWwgUmVzdGF1cmFudCBTeXN0ZW08L3RleHQ+PC9zdmc+') center/cover;
            color: white;
            padding: 5rem 0 3rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .menu-item {
            background: white;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .menu-item:hover {
            transform: translateY(-6px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.18);
        }

        .item-img {
            height: 180px;
            background: #eee;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }
        .item-img::after {
            content: attr(data-label);
            position: absolute;
            bottom: 0;
            left: 0;
            background: rgba(231, 76, 60, 0.92);
            color: white;
            padding: 0.35rem 0.9rem;
            font-size: 0.8rem;
            font-weight: 600;
            border-radius: 0 12px 0 0;
            backdrop-filter: blur(4px);
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0.75rem 0;
            touch-action: manipulation;
        }
        .quantity-btn {
            width: 42px;
            height: 42px;
            border: 2.5px solid var(--secondary);
            background: white;
            color: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            font-size: 1.1rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .quantity-btn:hover, .quantity-btn:active {
            background: var(--secondary);
            color: white;
            transform: scale(1.05);
        }
        .quantity-input {
            width: 60px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 0.4rem;
            font-weight: bold;
            font-size: 1.1rem;
            background: #f8f9fa;
        }

        .add-to-cart {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.65rem 1rem;
            border-radius: 30px;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
            font-size: 1rem;
            margin-top: auto;
        }
        .add-to-cart:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .spice-level {
            display: inline-flex;
            gap: 3px;
            margin-top: 0.4rem;
            align-items: center;
        }
        .spice-pepper {
            color: #e74c3c;
            font-size: 0.9rem;
        }

        .cart-toggle {
            position: fixed;
            bottom: calc(env(safe-area-inset-bottom, 20px) + 20px);
            right: 20px;
            width: 64px;
            height: 64px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.45);
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s;
        }
        .cart-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.55);
        }

        .cart-summary {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -6px 25px rgba(0,0,0,0.15);
            padding: 1.2rem 0;
            z-index: 1000;
            transition: all 0.35s ease;
            border-radius: 20px 20px 0 0;
            max-height: 70vh;
            overflow-y: auto;
        }

        .checkout-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.9rem 1.5rem;
            border-radius: 30px;
            font-weight: bold;
            width: 100%;
            margin-top: 0.75rem;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        .checkout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .hero { padding: 4rem 0 2.5rem; }
            .hero h1 { font-size: 2rem; }
            .item-img { height: 160px; }
            .quantity-btn { width: 40px; height: 40px; }
            .back-home { top: 65px; left: 12px; font-size: 14px; padding: 8px 12px; }
        }
    </style>
</head>
<body>

    <a href="index.html" class="back-home">
        <i class="fas fa-arrow-left me-1"></i>返回
    </a>

    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-utensils me-2"></i>Carter Dining
            </a>
        </div>
    </nav>

    <section class="hero">
        <div class="container">
            <h1>歡迎來到Carter Dining</h1>
            <p class="lead">線上點餐，輕鬆堂食或自取</p>
            <a href="#menu" class="btn btn-lg btn-warning text-dark fw-bold px-4">
                <i class="fas fa-arrow-down me-2"></i>立即點餐
            </a>
        </div>
    </section>

    <div class="container" id="menu"></div>

    <div class="cart-toggle" id="cartToggle">
        <i class="fas fa-shopping-cart fa-lg"></i>
        <span class="cart-badge" id="cartBadge">0</span>
    </div>

    <div class="cart-summary" id="cartSummary" style="transform: translateY(100%);">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0"><i class="fas fa-shopping-cart me-2"></i>購物車</h5>
                <button class="btn btn-sm btn-outline-secondary" id="clearCart">清空</button>
            </div>
            <div class="cart-items" id="cartItems">
                <div class="text-center py-4 text-muted">
                    <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                    <p>購物車是空的</p>
                </div>
            </div>
            <div class="cart-total fw-bold fs-5">
                總計: <span id="cartTotal">$0</span>
            </div>
            <button class="checkout-btn" id="checkoutBtn" data-bs-toggle="modal" data-bs-target="#checkoutModal">
                結帳
            </button>
        </div>
    </div>

    <!-- 結帳 Modal -->
    <div class="modal fade" id="checkoutModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header border-0 pb-2">
                    <h5 class="modal-title"><i class="fas fa-check-circle text-success me-2"></i>確認訂單</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body pt-2">
                    <div class="mb-3">
                        <label class="form-label fw-bold">用餐方式</label>
                        <select class="form-select" id="diningMethod">
                            <option value="dinein">堂食</option>
                            <option value="takeaway">外賣自取</option>
                        </select>
                    </div>

                    <div id="dineinSection">
                        <label class="form-label fw-bold">桌號</label>
                        <input type="text" class="form-control" id="tableNumber" placeholder="例如：A1、B3" maxlength="5">
                    </div>

                    <div id="takeawaySection" style="display:none;">
                        <label class="form-label fw-bold">取餐號碼</label>
                        <div class="order-number" id="pickupNumber">--</div>
                        <small class="text-muted">提交後系統自動分配</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">付款方式</label>
                        <select class="form-select">
                            <option>現金</option>
                            <option>八達通</option>
                            <option>PayMe</option>
                            <option>AlipayHK</option>
                            <option>WeChat Pay</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">備註</label>
                        <textarea class="form-control" rows="2" placeholder="例如：不要蔥、少辣"></textarea>
                    </div>
                </div>
                <div class="modal-footer border-0 pt-2">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary px-4" id="confirmOrder">
                        <i class="fas fa-paper-plane me-2"></i>提交訂單
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 成功 Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content text-center">
                <div class="modal-body p-4">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <h4 class="fw-bold">訂單已提交！</h4>
                    <div id="finalPickupNumber" class="order-number my-3"></div>
                    <p class="text-muted small" id="successMessage"></p>
                    <button class="btn btn-primary px-4" data-bs-dismiss="modal">完成</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // === 內嵌菜單資料 ===
        const menuData = [
            {
                "category": "頭盤",
                "items": [
                    { "title": "香脆春卷 (4件)", "desc": "新鮮蔬菜包裹，酥脆外皮，配特製甜酸醬", "price": 48, "image": "https://images.unsplash.com/photo-1541592106381-b31e9677c0e5?w=400", "spice": 1, "label": "人氣推薦" },
                    { "title": "沙律", "desc": "新鮮生菜、番茄、黃瓜，配油醋汁", "price": 38, "image": "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=400", "spice": 0 }
                ]
            },
            {
                "category": "主食",
                "items": [
                    { "title": "揚州炒飯", "desc": "蝦仁、叉燒、蛋花、青豆，香氣四溢", "price": 68, "image": "https://images.unsplash.com/photo-1603133872878-684f208fb84b?w=400", "spice": 0 },
                    { "title": "宮保雞丁", "desc": "嫩雞丁、花生、乾辣椒，麻辣鮮香", "price": 78, "image": "https://images.unsplash.com/photo-1626082927389-7e8bc2c2f0c6?w=400", "spice": 3, "label": "辣" },
                    { "title": "牛肉炒河", "desc": "嫩滑牛肉、河粉、豆芽，鑊氣十足", "price": 82, "image": "https://images.unsplash.com/photo-1623387641162-d941d77e4f95?w=400", "spice": 1 }
                ]
            },
            {
                "category": "飲品",
                "items": [
                    { "title": "凍檸茶", "desc": "香港經典，冰涼解渴", "price": 18, "image": "https://images.unsplash.com/photo-1622495671795-c50c2b53ac91?w=400", "spice": 0 },
                    { "title": "熱奶茶", "desc": "濃香絲滑，港式風味", "price": 18, "image": "https://images.unsplash.com/photo-1558160074-4d7d8bdf425d?w=400", "spice": 0 }
                ]
            }
        ];

        let cart = [];
        let pickupCounter = localStorage.getItem('pickupCounter') ? parseInt(localStorage.getItem('pickupCounter')) : 1;

        const els = {
            cartBadge: document.getElementById('cartBadge'),
            cartItems: document.getElementById('cartItems'),
            cartTotal: document.getElementById('cartTotal'),
            cartSummary: document.getElementById('cartSummary'),
            cartToggle: document.getElementById('cartToggle'),
            diningMethod: document.getElementById('diningMethod'),
            dineinSection: document.getElementById('dineinSection'),
            takeawaySection: document.getElementById('takeawaySection'),
            pickupNumber: document.getElementById('pickupNumber'),
            tableNumber: document.getElementById('tableNumber'),
            checkoutBtn: document.getElementById('checkoutBtn')
        };

        function loadMenu() {
            const container = document.getElementById('menu');
            container.innerHTML = '';
            menuData.forEach(cat => {
                const sec = document.createElement('div');
                sec.className = 'mb-5';
                sec.innerHTML = `<h2 class="h4 fw-bold mb-3"><i class="fas fa-leaf text-success me-2"></i>${cat.category}</h2><div class="row g-3"></div>`;
                container.appendChild(sec);
                const row = sec.querySelector('.row');
                cat.items.forEach(item => {
                    const col = document.createElement('div');
                    col.className = 'col-6 col-md-4';
                    col.innerHTML = `
                        <div class="menu-item">
                            <div class="item-img" style="background-image: url('${item.image}')" data-label="${item.label || ''}"></div>
                            <div class="p-3 d-flex flex-column flex-grow-1">
                                <h5 class="item-title mb-1 fw-bold">${item.title}</h5>
                                <p class="item-desc text-muted small flex-grow-1">${item.desc}</p>
                                <div class="spice-level mb-2">${'<i class="fas fa-pepper-hot spice-pepper"></i>'.repeat(item.spice || 0)}</div>
                                <div class="item-price text-primary fw-bold mb-2">$${item.price}</div>
                                <div class="quantity-control">
                                    <div class="quantity-btn minus">−</div>
                                    <input type="text" class="quantity-input" value="0" readonly>
                                    <div class="quantity-btn plus">+</div>
                                </div>
                                <button class="add-to-cart mt-2">加入購物車</button>
                            </div>
                        </div>`;
                    row.appendChild(col);
                });
            });
            bindEvents();
        }

        function bindEvents() {
            document.querySelectorAll('.quantity-control').forEach(ctrl => {
                const minus = ctrl.querySelector('.minus');
                const plus = ctrl.querySelector('.plus');
                const input = ctrl.querySelector('.quantity-input');
                const btn = ctrl.closest('.menu-item').querySelector('.add-to-cart');
                plus.onclick = () => { input.value = +input.value + 1; updateBtn(btn, +input.value); };
                minus.onclick = () => { if (+input.value > 0) { input.value = +input.value - 1; updateBtn(btn, +input.value); }};
            });

            document.querySelectorAll('.add-to-cart').forEach(btn => {
                btn.onclick = () => {
                    const item = btn.closest('.menu-item');
                    const title = item.querySelector('.item-title').textContent;
                    const price = parseInt(item.querySelector('.item-price').textContent.replace('$', ''));
                    const qty = parseInt(item.querySelector('.quantity-input').value);
                    if (qty > 0) {
                        const exist = cart.find(i => i.title === title);
                        exist ? exist.quantity += qty : cart.push({title, price, quantity: qty});
                        item.querySelector('.quantity-input').value = 0;
                        updateBtn(btn, 0);
                        btn.textContent = '已加入！'; btn.style.background = '#27ae60';
                        setTimeout(() => { btn.textContent = '加入購物車'; btn.style.background = ''; }, 800);
                        updateCart();
                    }
                };
            });
        }

        function updateBtn(btn, qty) {
            btn.textContent = qty > 0 ? `加入購物車 (${qty})` : '加入購物車';
        }

        function updateCart() {
            const totalItems = cart.reduce((s, i) => s + i.quantity, 0);
            const totalPrice = cart.reduce((s, i) => s + i.price * i.quantity, 0);
            els.cartBadge.textContent = totalItems;
            els.cartTotal.textContent = `$${totalPrice}`;
            els.checkoutBtn.textContent = totalPrice > 0 ? `結帳 ($${totalPrice})` : '結帳';

            if (cart.length === 0) {
                els.cartItems.innerHTML = `<div class="text-center py-4 text-muted"><i class="fas fa-shopping-cart fa-2x mb-2"></i><p>購物車是空的</p></div>`;
            } else {
                els.cartItems.innerHTML = '';
                cart.forEach((item, i) => {
                    const div = document.createElement('div');
                    div.className = 'd-flex justify-content-between align-items-center py-2 border-bottom';
                    div.innerHTML = `
                        <div><div class="small fw-bold">${item.title}</div><small class="text-muted">x${item.quantity}</small></div>
                        <div class="text-end"><div class="fw-bold">$${item.price * item.quantity}</div>
                        <i class="fas fa-times text-danger ms-2" style="cursor:pointer;" onclick="removeItem(${i})"></i></div>`;
                    els.cartItems.appendChild(div);
                });
            }
        }

        window.removeItem = i => { cart.splice(i, 1); updateCart(); };

        els.cartToggle.onclick = () => {
            const hidden = els.cartSummary.style.transform.includes('100%');
            els.cartSummary.style.transform = hidden ? 'translateY(0)' : 'translateY(100%)';
        };

        document.getElementById('clearCart').onclick = () => { cart = []; updateCart(); };

        els.diningMethod.onchange = () => {
            if (els.diningMethod.value === 'takeaway') {
                els.dineinSection.style.display = 'none';
                els.takeawaySection.style.display = 'block';
                els.pickupNumber.textContent = String(pickupCounter).padStart(3, '0');
            } else {
                els.dineinSection.style.display = 'block';
                els.takeawaySection.style.display = 'none';
            }
        };

        document.getElementById('confirmOrder').onclick = () => {
            if (cart.length === 0) return alert('購物車是空的！');
            if (els.diningMethod.value === 'dinein' && !els.tableNumber.value.trim()) return alert('請輸入桌號！');

            const method = els.diningMethod.value;
            let msg = '', num = '';
            if (method === 'takeaway') {
                num = String(pickupCounter).padStart(3, '0');
                msg = `您的取餐號碼是 <strong>${num}</strong><br>餐點準備好後將呼叫號碼。`;
                pickupCounter++;
                localStorage.setItem('pickupCounter', pickupCounter);
            } else {
                msg = `已通知廚房，餐點將送至 <strong>${els.tableNumber.value}</strong> 號桌。`;
            }

            document.getElementById('finalPickupNumber').textContent = method === 'takeaway' ? num : els.tableNumber.value;
            document.getElementById('successMessage').innerHTML = msg;

            cart = [];
            updateCart();
            els.cartSummary.style.transform = 'translateY(100%)';
            bootstrap.Modal.getInstance(document.getElementById('checkoutModal')).hide();
            new bootstrap.Modal(document.getElementById('successModal')).show();
        };

        loadMenu();
        updateCart();
    </script>
</body>
</html>
